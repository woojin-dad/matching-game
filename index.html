<!doctype html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìš°ì§„ì´ì˜ ìŠ¤ë§ˆíŠ¸ ë§¤ì¹­ ê²Œì„</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background: #FEE500; font-family: 'Apple SD Gothic Neo', sans-serif; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
        .container { width: 95%; max-width: 600px; background: white; padding: 25px; border-radius: 24px; box-shadow: 0 15px 35px rgba(0,0,0,0.15); position: relative; }
        .card { padding: 18px; border-radius: 14px; border: 3px solid #f3f4f6; text-align: center; cursor: pointer; font-weight: bold; transition: all 0.2s; background: white; font-size: 1.1rem; display: flex; align-items: center; justify-content: center; min-height: 70px; }
        .term-card { background: #3C1E1E; color: #FEE500; border-color: #3C1E1E; }
        .selected { border-color: #FEE500; transform: translateY(-3px); box-shadow: 0 8px 20px rgba(0,0,0,0.1); }
        .matched { opacity: 0.2; cursor: default; background: #e5e7eb !important; border-color: #e5e7eb !important; color: #9ca3af !important; transform: scale(0.95); }
        .mode-card { background: #3C1E1E; color: #FEE500; padding: 20px; border-radius: 18px; text-align: center; cursor: pointer; transition: 0.3s; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
        .mode-card:hover { transform: scale(1.03); }
        
        /* ìƒë‹¨ ìƒíƒœë°” */
        #statusBar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; background: #f9fafb; padding: 10px 15px; border-radius: 15px; }
        
        /* ì½”ì¸ ë°•ìŠ¤: ì„ ë¬¼ ì•„ì´ì½˜ê³¼ í¬ê¸° ë§ì¶¤ */
        .coin-box { font-weight: 900; color: #3C1E1E; font-size: 1.4rem; display: flex; align-items: center; gap: 4px; }
        .coin-icon { font-size: 1.6rem; } /* ğŸ ì•„ì´ì½˜ í¬ê¸°ì™€ ë§ì¶¤ */
        
        /* ì˜¤ë¥¸ìª½ ìƒë‹¨: ë²ˆê°œ(âš¡ï¸) - ê²Œì´ì§€(1.5ë°°) - ì„ ë¬¼(ğŸ) - ìˆ«ì */
        .gauge-section { display: flex; align-items: center; gap: 8px; }
        .gauge-bg { width: 120px; height: 10px; background: #e5e7eb; border-radius: 10px; overflow: hidden; position: relative; } /* ê¸°ì¡´ 80pxì—ì„œ 120pxë¡œ í™•ì¥ */
        #gaugeFill { height: 100%; width: 0%; background: linear-gradient(90deg, #FACC15, #EAB308); transition: width 0.6s cubic-bezier(0.34, 1.56, 0.64, 1); border-radius: 10px; }
        
        .reward-box { display: flex; align-items: center; gap: 4px; font-weight: 900; color: #3C1E1E; font-size: 1.4rem; }
        #giftIcon { font-size: 1.6rem; }
        #giftCount { color: #e11d48; min-width: 20px; text-align: left; }
        .energy-icon { font-size: 1.2rem; }

        @keyframes shake {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(-10deg); }
            75% { transform: rotate(10deg); }
        }
        .gift-active { animation: shake 0.5s infinite; }
    </style>
</head>
<body>

<div class="container">
    <div id="statusBar">
        <div class="coin-box">
            <span class="coin-icon">ğŸª™</span>
            <span id="coinCount">0</span>
        </div>
        
        <div class="gauge-section">
            <span class="energy-icon">âš¡ï¸</span>
            <div class="gauge-bg">
                <div id="gaugeFill"></div>
            </div>
            <div class="reward-box">
                <span id="giftIcon">ğŸ</span>
                <span id="giftCount">0</span>
            </div>
        </div>
    </div>

    <div id="mainPage">
        <h1 class="text-3xl font-black text-center mb-8 text-[#3C1E1E]">ìš°ì§„ì´ì˜ ë§¤ì¹­ ê²Œì„</h1>
        <div id="modeGrid" class="grid gap-4">
            <p class="text-center text-gray-500">ì‹œíŠ¸ì—ì„œ ë‹¨ì–´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘...</p>
        </div>
    </div>

    <div id="gamePage" style="display:none;">
        <button onclick="goToMain()" class="mb-4 flex items-center text-[#3C1E1E] font-bold">
            <span class="mr-1">ğŸ </span> ì²˜ìŒìœ¼ë¡œ
        </button>
        <h2 id="gameTitle" class="text-2xl font-bold text-center mb-6 text-[#3C1E1E]"></h2>
        <div class="grid grid-cols-2 gap-4">
            <div id="termsColumn" class="flex flex-col gap-3"></div>
            <div id="definitionsColumn" class="flex flex-col gap-3"></div>
        </div>
    </div>
</div>

<script>
    const sheetUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vT3vqts3wY7dCnxbXq1pedePNTOH32_sNnxqAgqx4EIYtaTok3NU-HpwdYOaNIdWFvogYEd6JI1pst1/pub?output=csv";

    let gameData = [];
    
    let state = {
        selectedTerm: null,
        selectedDef: null,
        coins: parseInt(localStorage.getItem('woojin_coins')) || 0,
        totalMatchedCount: parseInt(localStorage.getItem('woojin_matched_total')) || 0,
        giftCount: parseInt(localStorage.getItem('woojin_gift_count')) || 0,
        maxGauge: 500,
        maxCoins: 1000000
    };

    async function fetchSheetData() {
        try {
            const response = await fetch(sheetUrl);
            const csvText = await response.text();
            const rows = csvText.split('\r\n').filter(row => row.trim() !== '').slice(1); 

            gameData = rows.map(row => {
                const parts = row.split(',');
                const title = parts[0];
                const icon = parts[1];
                const itemsStr = parts.slice(2).join(',');
                if(!itemsStr) return null;
                const items = itemsStr.split(';').map(item => {
                    const [t, d] = item.split('/');
                    return t && d ? { t: t.trim(), d: d.trim() } : null;
                }).filter(i => i);
                return { title: title.trim(), icon: icon.trim(), items };
            }).filter(d => d);

            renderMenu();
            updateUI(); 
        } catch (e) {
            console.error(e);
            document.getElementById('modeGrid').innerHTML = "ë°ì´í„° ë¡œë”© ì‹¤íŒ¨";
        }
    }

    function renderMenu() {
        const grid = document.getElementById('modeGrid');
        grid.innerHTML = '';
        gameData.forEach((mode, idx) => {
            const div = document.createElement('div');
            div.className = 'mode-card';
            div.innerHTML = `<div class="text-3xl mb-1">${mode.icon}</div><div class="font-bold text-lg">${mode.title}</div>`;
            div.onclick = () => startGame(idx);
            grid.appendChild(div);
        });
    }

    function startGame(idx) {
        const mode = gameData[idx];
        document.getElementById('mainPage').style.display = 'none';
        document.getElementById('gamePage').style.display = 'block';
        document.getElementById('gameTitle').innerText = mode.title;

        const tCol = document.getElementById('termsColumn');
        const dCol = document.getElementById('definitionsColumn');
        tCol.innerHTML = ''; dCol.innerHTML = '';
        
        const terms = [...mode.items].sort(() => Math.random() - 0.5);
        const defs = [...mode.items].sort(() => Math.random() - 0.5);

        terms.forEach(item => {
            const card = document.createElement('div');
            card.className = 'card term-card';
            card.innerText = item.t;
            card.onclick = () => selectCard(item, 'term', card);
            tCol.appendChild(card);
        });

        defs.forEach(item => {
            const card = document.createElement('div');
            card.className = 'card';
            card.innerText = item.d;
            card.onclick = () => selectCard(item, 'def', card);
            dCol.appendChild(card);
        });
    }

    function goToMain() {
        document.getElementById('mainPage').style.display = 'block';
        document.getElementById('gamePage').style.display = 'none';
    }

    function updateUI() {
        if (state.coins > state.maxCoins) state.coins = state.maxCoins;
        document.getElementById('coinCount').innerText = state.coins.toLocaleString();
        
        state.giftCount = Math.floor(state.totalMatchedCount / state.maxGauge);
        const currentProgress = state.totalMatchedCount % state.maxGauge;
        
        document.getElementById('giftCount').innerText = state.giftCount;
        
        const percent = (currentProgress / state.maxGauge) * 100;
        document.getElementById('gaugeFill').style.width = percent + '%';
        
        localStorage.setItem('woojin_coins', state.coins);
        localStorage.setItem('woojin_matched_total', state.totalMatchedCount);
        localStorage.setItem('woojin_gift_count', state.giftCount);
        
        if(percent > 90) {
            document.getElementById('giftIcon').classList.add('gift-active');
        } else {
            document.getElementById('giftIcon').classList.remove('gift-active');
        }
    }

    function selectCard(item, type, el) {
        if(el.classList.contains('matched')) return;
        
        if(type === 'term') {
            document.querySelectorAll('.term-card').forEach(c => c.classList.remove('selected'));
            state.selectedTerm = { item, el };
        } else {
            document.querySelectorAll('#definitionsColumn .card').forEach(c => c.classList.remove('selected'));
            state.selectedDef = { item, el };
        }
        el.classList.add('selected');

        if(state.selectedTerm && state.selectedDef) {
            if(state.selectedTerm.item.t === state.selectedDef.item.t) {
                state.selectedTerm.el.classList.add('matched');
                state.selectedDef.el.classList.add('matched');
                
                state.coins += 1;
                state.totalMatchedCount += 1;
                
                if(state.totalMatchedCount % state.maxGauge === 0 && state.totalMatchedCount !== 0) {
                    setTimeout(() => alert("ğŸ ëŒ€ë‹¨í•´ìš”! 500ìŒ ë‹¬ì„±! ì„ ë¬¼ ìˆ«ìê°€ ì˜¬ë¼ê°”ì–´ìš”!"), 100);
                }

                updateUI();
                
                state.selectedTerm = null; state.selectedDef = null;
                
                const currentModeItems = gameData.find(g => g.title === document.getElementById('gameTitle').innerText).items.length;
                const matchedInGame = document.querySelectorAll('.matched').length / 2;
                
                if(matchedInGame === currentModeItems) {
                    setTimeout(() => alert("ì°¸ ì˜í–ˆì–´ìš”! ìš°ì§„ì´ ìµœê³ ! ğŸ‘"), 300);
                }
            } else {
                setTimeout(() => {
                    if(state.selectedTerm) state.selectedTerm.el.classList.remove('selected');
                    if(state.selectedDef) state.selectedDef.el.classList.remove('selected');
                    state.selectedTerm = null; state.selectedDef = null;
                }, 400);
            }
        }
    }

    fetchSheetData();
</script>
</body>
</html>