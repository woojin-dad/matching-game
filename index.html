<!doctype html>
<html lang="ko" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìš°ì§„ì´ì˜ ë§¤ì¹­ ê²Œì„ (ë…ë¦½ ê´€ë¦¬í˜•)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* ê¸°ì¡´ ìŠ¤íƒ€ì¼ ìœ ì§€ */
        body { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', sans-serif; background: #FEE500; min-height: 100%; display: flex; justify-content: center; align-items: center; padding: 20px; }
        .status-bar { position: fixed; top: 15px; left: 15px; right: 15px; display: flex; justify-content: space-between; align-items: center; z-index: 1000; }
        .coin-display, .energy-display { background: #3C1E1E; color: #FEE500; padding: 8px 16px; border-radius: 20px; font-weight: bold; box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2); display: flex; align-items: center; gap: 8px; }
        .energy-bar-container { width: 100px; height: 12px; background: #5a3535; border-radius: 6px; overflow: hidden; }
        .energy-bar-fill { height: 100%; background: #4ade80; width: 0%; transition: width 0.3s ease; }
        .container { width: 95%; max-width: 800px; background: white; border-radius: 20px; padding: 30px; box-shadow: 0 20px 60px rgba(0,0,0,0.2); margin-top: 50px; }
        .main-title { font-size: 36px; font-weight: bold; color: #3C1E1E; text-align: center; margin-bottom: 30px; }
        .mode-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; }
        .mode-card { background: #3C1E1E; color: #FEE500; padding: 25px; border-radius: 15px; cursor: pointer; text-align: center; transition: 0.3s; }
        .mode-card:hover { transform: translateY(-5px); }
        .game-page, .admin-page { display: none; }
        .game-area { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px; }
        .card { padding: 15px; border-radius: 12px; cursor: pointer; text-align: center; border: 3px solid #e9ecef; font-weight: bold; min-height: 60px; display: flex; align-items: center; justify-content: center; transition: 0.2s; }
        .term-card { background: #3C1E1E; color: #FEE500; }
        .card.selected { border-color: #ffd700; transform: scale(1.05); }
        .card.matched { opacity: 0.3; cursor: default; background: #ddd !important; color: #888 !important; }
        .back-button { background: #eee; border: none; padding: 8px 15px; border-radius: 10px; cursor: pointer; margin-bottom: 15px; }
        .admin-btn { position: fixed; bottom: 20px; right: 20px; background: #3C1E1E; color: white; border-radius: 50%; width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; cursor: pointer; opacity: 0.5; }
    </style>
</head>
<body>

<div class="status-bar">
    <div class="coin-display">ğŸª™ <span id="coinScore">0</span></div>
    <div class="energy-display">
        ğŸ’ª <div class="energy-bar-container"><div class="energy-bar-fill" id="energyBarFill"></div></div>
        ğŸ <span id="couponCount">0</span>
    </div>
</div>

<div class="container">
    <main id="mainPage">
        <h1 class="main-title">ìš°ì§„ì´ì˜ ë§¤ì¹­ ê²Œì„</h1>
        <div class="mode-grid" id="modeGrid">
            </div>
    </main>

    <section id="gamePage" class="game-page">
        <button class="back-button" onclick="goToMain()">â† ëŒì•„ê°€ê¸°</button>
        <h2 id="gameTitle" class="text-2xl font-bold text-center mb-4"></h2>
        <div class="game-area">
            <div id="termsColumn" class="flex flex-col gap-3"></div>
            <div id="definitionsColumn" class="flex flex-col gap-3"></div>
        </div>
    </section>

    <section id="adminPage" class="admin-page">
        <button class="back-button" onclick="goToMain()">â† ëŒì•„ê°€ê¸°</button>
        <h2 class="text-2xl font-bold mb-4">ë°ì´í„° ê´€ë¦¬</h2>
        <textarea id="dataInput" class="w-full h-64 p-4 border rounded mb-4" placeholder="ë©”ë‰´ì´ë¦„|ì•„ì´ì½˜|ë‹¨ì–´/ëœ»,ë‹¨ì–´/ëœ»"></textarea>
        <button onclick="saveData()" class="w-full bg-black text-white p-4 rounded-xl font-bold">ë°ì´í„° ì €ì¥í•˜ê¸°</button>
        <p class="mt-4 text-sm text-gray-500">í˜•ì‹: ë©”ë‰´ëª…|ì•„ì´ì½˜|ë‹¨ì–´1/ëœ»1,ë‹¨ì–´2/ëœ»2...</p>
    </section>
</div>

<div class="admin-btn" onclick="showAdmin()">âš™ï¸</div>

<script>
    // 1. ì§ì ‘ ê´€ë¦¬í•  ë°ì´í„° (Local Storage ì‚¬ìš©)
    // ìº”ë°”ê°€ ìŠì–´ë²„ë ¤ë„ ë¸Œë¼ìš°ì €ì— ì €ì¥ë˜ê±°ë‚˜ ë‚˜ì¤‘ì— êµ¬ê¸€ ì‹œíŠ¸ë¡œ ì—°ê²° ê°€ëŠ¥
    let gameData = JSON.parse(localStorage.getItem('woojin_game_data')) || [
        { title: "ê³¼ì¼ ìµíˆê¸°", icon: "ğŸ", items: [{t:"ì‚¬ê³¼", d:"Apple"}, {t:"í¬ë„", d:"Grape"}] },
        { title: "í•œì ê³µë¶€", icon: "ğŸ®", items: [{t:"æœ¨", d:"ë‚˜ë¬´ ëª©"}, {t:"å±±", d:"ë©” ì‚°"}] }
    ];

    let state = {
        coins: parseInt(localStorage.getItem('coins')) || 0,
        selectedTerm: null,
        selectedDef: null,
        matched: []
    };

    // 2. í™”ë©´ ì´ˆê¸°í™”
    function init() {
        const grid = document.getElementById('modeGrid');
        grid.innerHTML = '';
        gameData.forEach((mode, idx) => {
            const card = document.createElement('div');
            card.className = 'mode-card';
            card.innerHTML = `<div class="text-4xl mb-2">${mode.icon}</div><div class="font-bold">${mode.title}</div>`;
            card.onclick = () => startGame(idx);
            grid.appendChild(card);
        });
        updateStatus();
    }

    // 3. ê²Œì„ ë¡œì§
    function startGame(idx) {
        const mode = gameData[idx];
        document.getElementById('mainPage').style.display = 'none';
        document.getElementById('gamePage').style.display = 'block';
        document.getElementById('gameTitle').textContent = mode.title;

        state.matched = [];
        renderCards(mode.items);
    }

    function renderCards(items) {
        const tCol = document.getElementById('termsColumn');
        const dCol = document.getElementById('definitionsColumn');
        tCol.innerHTML = ''; dCol.innerHTML = '';

        const shuffledTerms = [...items].sort(() => Math.random() - 0.5);
        const shuffledDefs = [...items].sort(() => Math.random() - 0.5);

        shuffledTerms.forEach(item => {
            const div = document.createElement('div');
            div.className = 'card term-card';
            div.textContent = item.t;
            div.onclick = () => selectCard(item, 'term', div);
            tCol.appendChild(div);
        });

        shuffledDefs.forEach(item => {
            const div = document.createElement('div');
            div.className = 'card';
            div.textContent = item.d;
            div.onclick = () => selectCard(item, 'def', div);
            dCol.appendChild(div);
        });
    }

    function selectCard(item, type, el) {
        if (el.classList.contains('matched')) return;

        if (type === 'term') {
            document.querySelectorAll('.term-card').forEach(c => c.classList.remove('selected'));
            state.selectedTerm = item;
        } else {
            document.querySelectorAll('#definitionsColumn .card').forEach(c => c.classList.remove('selected'));
            state.selectedDef = item;
        }
        el.classList.add('selected');

        if (state.selectedTerm && state.selectedDef) {
            if (state.selectedTerm.t === state.selectedDef.t) {
                // ì •ë‹µ
                state.coins += 10;
                document.querySelectorAll('.selected').forEach(c => {
                    c.classList.add('matched');
                    c.classList.remove('selected');
                });
                state.selectedTerm = null; state.selectedDef = null;
                updateStatus();
                checkWin();
            } else {
                // ì˜¤ë‹µ
                setTimeout(() => {
                    document.querySelectorAll('.selected').forEach(c => c.classList.remove('selected'));
                    state.selectedTerm = null; state.selectedDef = null;
                }, 500);
            }
        }
    }

    function checkWin() {
        if (document.querySelectorAll('.matched').length === document.querySelectorAll('.card').length) {
            alert("ì¶•í•˜í•©ë‹ˆë‹¤! ëª¨ë‘ ë§í˜”ì–´ìš”!");
            goToMain();
        }
    }

    // 4. ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
    function updateStatus() {
        document.getElementById('coinScore').textContent = state.coins;
        localStorage.setItem('coins', state.coins);
        // ì—ë„ˆì§€ë°” ë¡œì§ ë“± ì¶”ê°€ ê°€ëŠ¥
    }

    function goToMain() {
        document.getElementById('mainPage').style.display = 'block';
        document.getElementById('gamePage').style.display = 'none';
        document.getElementById('adminPage').style.display = 'none';
        init();
    }

    function showAdmin() {
        document.getElementById('mainPage').style.display = 'none';
        document.getElementById('adminPage').style.display = 'block';
        // í˜„ì¬ ë°ì´í„°ë¥¼ í…ìŠ¤íŠ¸ë¡œ í‘œì‹œ
        document.getElementById('dataInput').value = gameData.map(m => 
            `${m.title}|${m.icon}|${m.items.map(i => `${i.t}/${i.d}`).join(',')}`
        ).join('\n');
    }

    function saveData() {
        const text = document.getElementById('dataInput').value;
        const lines = text.split('\n');
        const newData = lines.map(line => {
            const [title, icon, itemStr] = line.split('|');
            const items = itemStr.split(',').map(i => {
                const [t, d] = i.split('/');
                return {t, d};
            });
            return {title, icon, items};
        });
        gameData = newData;
        localStorage.setItem('woojin_game_data', JSON.stringify(newData));
        alert("ë°ì´í„°ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!");
        goToMain();
    }

    init();
</script>
</body>
</html>