<!doctype html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìš°ì§„ì´ì˜ ìŠ¤ë§ˆíŠ¸ ë§¤ì¹­ ê²Œì„</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background: #FEE500; font-family: 'Apple SD Gothic Neo', sans-serif; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
        .container { width: 95%; max-width: 600px; background: white; padding: 25px; border-radius: 24px; box-shadow: 0 15px 35px rgba(0,0,0,0.15); }
        .card { padding: 18px; border-radius: 14px; border: 3px solid #f3f4f6; text-align: center; cursor: pointer; font-weight: bold; transition: all 0.2s; background: white; font-size: 1.1rem; display: flex; align-items: center; justify-content: center; min-height: 70px; }
        .term-card { background: #3C1E1E; color: #FEE500; border-color: #3C1E1E; }
        .selected { border-color: #FEE500; transform: translateY(-3px); box-shadow: 0 8px 20px rgba(0,0,0,0.1); }
        .matched { opacity: 0.2; cursor: default; background: #e5e7eb !important; border-color: #e5e7eb !important; color: #9ca3af !important; }
        .mode-card { background: #3C1E1E; color: #FEE500; padding: 20px; border-radius: 18px; text-align: center; cursor: pointer; transition: 0.3s; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
        .mode-card:hover { transform: scale(1.03); }
    </style>
</head>
<body>

<div class="container">
    <div id="mainPage">
        <h1 class="text-3xl font-black text-center mb-8 text-[#3C1E1E]">ìš°ì§„ì´ì˜ ë§¤ì¹­ ê²Œì„</h1>
        <div id="modeGrid" class="grid gap-4">
            <p class="text-center text-gray-500">ì‹œíŠ¸ì—ì„œ ë‹¨ì–´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘...</p>
        </div>
    </div>

    <div id="gamePage" style="display:none;">
        <button onclick="location.reload()" class="mb-4 flex items-center text-[#3C1E1E] font-bold">
            <span class="mr-1">ğŸ </span> ì²˜ìŒìœ¼ë¡œ
        </button>
        <h2 id="gameTitle" class="text-2xl font-bold text-center mb-6 text-[#3C1E1E]"></h2>
        <div class="grid grid-cols-2 gap-4">
            <div id="termsColumn" class="flex flex-col gap-3"></div>
            <div id="definitionsColumn" class="flex flex-col gap-3"></div>
        </div>
    </div>
</div>

<script>
    // âœ… ìš°ì§„ë‹˜ì´ ì£¼ì‹  êµ¬ê¸€ ì‹œíŠ¸ ì£¼ì†Œê°€ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤.
    const sheetUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vT3vqts3wY7dCnxbXq1pedePNTOH32_sNnxqAgqx4EIYtaTok3NU-HpwdYOaNIdWFvogYEd6JI1pst1/pub?output=csv";

    let gameData = [];
    let state = { selectedTerm: null, selectedDef: null };

    // êµ¬ê¸€ ì‹œíŠ¸ì—ì„œ ë°ì´í„°ë¥¼ ì½ì–´ì˜¤ëŠ” ë§ˆë²•
    async function fetchSheetData() {
        try {
            const response = await fetch(sheetUrl);
            const csvText = await response.text();
            
            // CSV íŒŒì‹± (ì¤„ë°”ê¿ˆê³¼ ì‰¼í‘œ ê¸°ì¤€)
            const rows = csvText.split('\r\n').filter(row => row.trim() !== '').slice(1); 

            gameData = rows.map(row => {
                // ë‹¨ìˆœ ì‰¼í‘œ ë¶„ë¦¬ (ë°ì´í„° ë‚´ë¶€ì— ì‰¼í‘œê°€ ì—†ë‹¤ê³  ê°€ì •)
                const [title, icon, itemsStr] = row.split(',');
                if(!itemsStr) return null;

                // ì„¸ë¯¸ì½œë¡ (;)ìœ¼ë¡œ ë‹¨ì–´ìŒ êµ¬ë¶„, ìŠ¬ë˜ì‹œ(/)ë¡œ ë‹¨ì–´/ëœ» êµ¬ë¶„
                const items = itemsStr.split(';').map(item => {
                    const [t, d] = item.split('/');
                    return t && d ? { t: t.trim(), d: d.trim() } : null;
                }).filter(i => i);

                return { title: title.trim(), icon: icon.trim(), items };
            }).filter(d => d);

            renderMenu();
        } catch (e) {
            console.error(e);
            document.getElementById('modeGrid').innerHTML = "ì‹œíŠ¸ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ì£¼ì†Œë¥¼ ë‹¤ì‹œ í™•ì¸í•´ì£¼ì„¸ìš”!";
        }
    }

    function renderMenu() {
        const grid = document.getElementById('modeGrid');
        grid.innerHTML = '';
        gameData.forEach((mode, idx) => {
            const div = document.createElement('div');
            div.className = 'mode-card';
            div.innerHTML = `<div class="text-3xl mb-1">${mode.icon}</div><div class="font-bold text-lg">${mode.title}</div>`;
            div.onclick = () => startGame(idx);
            grid.appendChild(div);
        });
    }

    function startGame(idx) {
        const mode = gameData[idx];
        document.getElementById('mainPage').style.display = 'none';
        document.getElementById('gamePage').style.display = 'block';
        document.getElementById('gameTitle').innerText = mode.title;

        const tCol = document.getElementById('termsColumn');
        const dCol = document.getElementById('definitionsColumn');
        
        // ì¹´ë“œ ì„ê¸°
        const terms = [...mode.items].sort(() => Math.random() - 0.5);
        const defs = [...mode.items].sort(() => Math.random() - 0.5);

        terms.forEach(item => {
            const card = document.createElement('div');
            card.className = 'card term-card';
            card.innerText = item.t;
            card.onclick = () => selectCard(item, 'term', card);
            tCol.appendChild(card);
        });

        defs.forEach(item => {
            const card = document.createElement('div');
            card.className = 'card';
            card.innerText = item.d;
            card.onclick = () => selectCard(item, 'def', card);
            dCol.appendChild(card);
        });
    }

    function selectCard(item, type, el) {
        if(el.classList.contains('matched')) return;
        
        if(type === 'term') {
            document.querySelectorAll('.term-card').forEach(c => c.classList.remove('selected'));
            state.selectedTerm = { item, el };
        } else {
            document.querySelectorAll('#definitionsColumn .card').forEach(c => c.classList.remove('selected'));
            state.selectedDef = { item, el };
        }
        el.classList.add('selected');

        if(state.selectedTerm && state.selectedDef) {
            // ì •ë‹µ í™•ì¸
            if(state.selectedTerm.item.t === state.selectedDef.item.t) {
                state.selectedTerm.el.classList.add('matched');
                state.selectedDef.el.classList.add('matched');
                state.selectedTerm = null; state.selectedDef = null;
                
                // ëª¨ë“  ì¹´ë“œë¥¼ ë§ì·„ëŠ”ì§€ í™•ì¸
                if(document.querySelectorAll('.matched').length === (gameData.find(g => g.title === document.getElementById('gameTitle').innerText).items.length * 2)) {
                    setTimeout(() => alert("ì°¸ ì˜í–ˆì–´ìš”! ìš°ì§„ì´ ìµœê³ ! ğŸ‘"), 300);
                }
            } else {
                // ì˜¤ë‹µì¼ ê²½ìš° ì„ íƒ í•´ì œ
                setTimeout(() => {
                    if(state.selectedTerm) state.selectedTerm.el.classList.remove('selected');
                    if(state.selectedDef) state.selectedDef.el.classList.remove('selected');
                    state.selectedTerm = null; state.selectedDef = null;
                }, 400);
            }
        }
    }

    fetchSheetData();
</script>
</body>
</html>